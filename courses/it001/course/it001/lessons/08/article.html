<html>
    <head>
    </head>
    <body>
        <article chapter-id="08">

            <!-- -------------------------------- Heading level 1 -------------------------------- -->
            <h1>Functions</h1>
            <p>
                The concept of functions is leaning on an old definition of functions in mathematics. In 1748,
                Leonhard Euler defined a function such:
            </p>
            <div class="quote">
                A function of a variable quantity is an analytic expression composed in any way whatsoever 
                of the variable quantity and numbers or constant quantities.<br/>
                (Euler, Leonhard (1988). Introduction to Analysis of the Infinite. Book I. Springer-Verlag.)
            </div>
            <p>
                A function was seen as an analytic expression. Maybe the concept of functions in programming 
                leans on the idea that a usually long mathematical expression is substituted by a short name
                (plus arguments). For example, the function 
                <font style="font-family: serif; font-style: italic;">
                    f&nbsp;(x)&nbsp;=&nbsp;2x<sup>3</sup>&nbsp;+&nbsp;5x<sup>2</sup>&nbsp;-&nbsp;8
                </font> 
                equates a short symbol 
                <font style="font-family: serif; font-style: italic;">
                    f&nbsp;(x)
                </font> 
                with a longer expression 
                <font style="font-family: serif; font-style: italic;">
                    2x<sup>3</sup>&nbsp;+&nbsp;5x<sup>2</sup>&nbsp;-&nbsp;8
                </font>.
            </p>

            <!-- -------------------------------- Heading level 1 -------------------------------- -->
            <h2>Function calls</h2>
            <p>
                In programming a function is a sub program, i.e. a 'program within a program'. The program  
                uses the function by <em>calling</em> it (<em>function call</em>). The function call will 
                pass control to the function, and once the function has finished, control will <em>return</em>
                to the statement following the one that called the function.
            </p>
            <figure>
                <img src="course/it001/lessons/08/img/01.png"/>
                <figcaption>Function call</figcaption>
            </figure>
            <p>
                This example program writes the current time to the console whenever it is called:
            </p>
            <div class="example" demo-id="it001_Ex_08_010">
                <pre class="prettyprint">
                    /* -  Function definition - */
                    function LogTime ()
                    {
                        console.log (new Date().toISOString ());
                    }

                    /* ----- Main program ----- */
                    /* ...   Lots of stuff  ... */

                    /* Function call            */
                    LogTime ();

                    /* Another function call    */
                    LogTime ();
                </pre>
            </div>
            <p>
                A function can be called from more than one place in a program, also from inside another function.
                Control will always return to the statement from where the function was called.
            </p>
            <figure>
                <img src="course/it001/lessons/08/img/02.png"/>
                <figcaption>Nested function calls</figcaption>
            </figure>
            <p>
                Here's a program for sorting three random numbers. The program uses nested function calls:
            </p>
            <div class="example" demo-id="it001_Ex_08_020">
                <pre class="prettyprint">
                    function LogTime ()
                    {
                        console.log (new Date().toISOString ());
                    }

                    function LogProgramStart ()
                    {
                        LogTime ();
                        console.log ("Program run started")
                    }

                    function LogProgramEnd ()
                    {
                        LogTime ();
                        console.log ("Program run finished")
                    }

                    var x = [6702568390, 7785219811, 303673531];
                    var i;
                    var j;
                    var temp;
                    
                    LogProgramStart ();

                    for (i = 0; i < x.length-1; i++)
                    {
                        for (j = i+1; j < x.length; j++)
                        {
                            if (x [i] < x [j])
                            {
                                /* swap x [i] and x [j] */
                                temp    = x [i];
                                x [i]   = x [j];
                                x [j]   = temp;
                            }
                        }
                    }

                    LogProgramEnd ();
                </pre>                            
            </div>


            <!-- -------------------------------- Heading level 2 -------------------------------- -->
            <h3>Functions in expressions</h3>

            <p>
                A function can also be called as part of an expression. When the expression is being evaluated 
                the function will be called at the appropriate time during evaluation of the term. Values returned
                from the function will be used as if they had been directly put into the term. In the illustrated
                example, <tt>a</tt> is assigned the value 10.
            </p>
            <figure>
                <img src="course/it001/lessons/08/img/03.png"/>
                <figcaption>Function as part of an expression</figcaption>
            </figure>
            <p>
                A term can contain several function calls. The resp. functions will be called at the appropriate time,
                and return values will be used for the calculation. In this illustrated example, <tt>a</tt> will
                be assigned the value 10 + 3 * 4 = 22.
            </p>
            <figure>
                <img src="course/it001/lessons/08/img/04.png"/>
                <figcaption>Several function calls</figcaption>
            </figure>


            <!-- -------------------------------- Heading level 2 -------------------------------- -->
            <h2>Advantages</h2>
            <p>
                There are multiple advantages of using functions:
            </p>
            <dl>
                <dt>Code savings</dt>
                <dd>
                    As in algebra, once a function is defined it can be used 
                    over and over, just by invoking its name. Since the 
                    function name is much shorter than the function itself, 
                    using functions saves a great amount of coding.
                </dd>
                <dt>More robust programs</dt>
                <dd>
                    Once a function works as expected it will work correctly
                    whenever it's called. A bug in a function has more impact 
                    on the program, but it just needs to be fixed in one place 
                    to remove the bug from the entire program.
                </dd>
                <dt>Clearer code</dt>
                <dd>
                    Code using well written functions is much easier to 
                    understand and maintain.
                </dd>
            </dl>
            <div class="note">
                If functions are written well, they can be offered as libraries 
                for other developers to use in their projects. For example, 
                this website uses a library "prettify" which is used to format 
                the source code examples. 
            </div>


            <!-- -------------------------------- Heading level 2 -------------------------------- -->
            <h2>Using functions</h2>
            <p>
                Just like with variables, 
                a function needs to be declared and defined before it can be used. 
                Thankfully, Javascript brings both things together, so declaring 
                and defining are done in one step. But there are other languages 
                (for example, C++) where declaration and definition can be  
                separated (even using separate files).
            </p>


            <!-- -------------------------------- Heading level 3 -------------------------------- -->
            <h3>Function declaration / definition</h3>
            <p>
                Before we can use a function we need to declare and define it. Javascript does both in one step. 
                A function declaration/definition...
            </p>
            <ul>
                <li>
                    ... starts with the keyword <tt>function</tt>,
                </li>
                <li>
                    ... followed by the <em>function name</em>,
                </li>
                <li>
                    ... then by a comma separated list of <em>parameters</em>, enclosed in brackets,
                </li>
                <li>
                    ... then followed by the <em>function body</em> which is a block of statements in braces <tt>{}</tt>. 
                </li>
            </ul>
            <p>
                Here's an example of a function declaration/definition:
            </p>
            <div class="example">
                <pre class="prettyprint">
                    function LogMessage (time, message)
                    {
                        var out;

                        out = time + " - " + message;
                        console.log (out);
                    }
                </pre>
            </div>



            <!-- -------------------------------- Heading level 4 -------------------------------- -->
            <h4>Function name</h4>
            <div class="example">
                <pre class="prettyprint">
                    function LogMessage (time, message)
                    // ------^^^^^^^^^^
                </pre>
            </div>
            <p>
                In most programming languages, functions must have a name. This can be a mix of letters (a-z, A-Z), 
                digits (0-9) and the underscore ('_'). The first character in the function name must not be a digit. 
                Avoid any other characters such as whitespace. Examples of valid function names would be: 
                <tt>GetWindow</tt>, <tt>setID</tt>, <tt>computeCorner_1</tt>. Examples of invalid function names 
                would be: <tt>21SectionLog</tt> (starts with a digit), <tt>Get&nbsp;My&nbsp;Coordinates</tt> 
                (contains spaces), <tt>log-message</tt> (contains illegal character [hyphen '<tt>-</tt>']).<br/>
                In the above example, the function name is <tt>LogMessage</tt>.
            </p>
            <div class="note">
                Javascript allows for anonymous functions, i.e. functions without a name. This feature is often 
                used by Javascript developers and does have good benefits for Javascript programs. We won't handle 
                anonymous functions because they're not part of many other languages.
            </div>


            <!-- -------------------------------- Heading level 4 -------------------------------- -->
            <h4>Parameter list</h4>
            <div class="example">
                <pre class="prettyprint">
                    function LogMessage (time, message)
                    // ------------------^^^^^^^^^^^^^
                </pre>
            </div>
            <p>
                Often a function needs data for its work. This needs to be indicated in the function declaration 
                by providing a <em>parameter list</em> inside the brackets after the function name. A parameter 
                is very similar to a variable, so a parameter list consists of one or more variable identifiers 
                (comma separated if there's more than one variable). When the function is executed, the parameters 
                can be used just like regular variables.<br/>
                In the above example, the parameter list is (<tt>time, message</tt>). It contains two parameters, 
                <tt>time</tt> and <tt>message</tt>, separated by one comma '<tt>,</tt>'. Both parameters are used 
                inside the function body, in line 5. 
            </p>


            <!-- -------------------------------- Heading level 4 -------------------------------- -->
            <h4>Function body</h4>
            <div class="example">
                <pre class="prettyprint">
                    function LogMessage (time, message)
                    {                                       //
                        var out;                            //
                                                            //  Function
                        out = time + " - " + message;       //    body
                        console.log (out);                  //
                    }                                       //
                </pre>
            </div>
            <p>
                The function body defines the 'business part' of the function. This is where 'stuff happens'. The 
                function body is executed whenever the function is called. Any arguments to the function can be used 
                like regular variables, and computed values can be returned to the calling party using the 
                <tt>return</tt> statement.
            </p>


            <!-- -------------------------------- Heading level 3 -------------------------------- -->
            <h3>Function call</h3>
            <p>
                Once the function has been declared/defined it can be used by calling it. A <em>function call</em> 
                consists of the function name followed by a list of values to be passed as parameters (as specified 
                in the function declaration). For example, to call the function <tt>LogMessage</tt> from the above 
                example, one could simply write
            </p>
            <div class="example">
                <pre class="prettyprint">
                    LogMessage ("10:45", "Oopsidaisy, my frobutron just grommicked!");
                </pre>
            </div>
            <p>
                anywhere in the program. When the Javascript engine executes the function call statement, 
                <ol>
                    <li>
                        control will pass to the function <tt>LogMessage</tt>,
                    </li>
                    <li>
                        the arguments "10:45" and "Oopsidaisy, my frobutron just grommicked!" would be passed as parameters 
                        <tt>time</tt> and <tt>message</tt> (as defined in the parameter list in the function declaration),
                    </li>
                    <li>
                        the function would create the message "10:45 - Oopsidaisy, my frobutron just grommicked!"
                        and print it to the Javascript console for the whole universe to behold (provided the universe 
                        activates the developer tools and clicks on the console tab).
                    </li>
                </ol>
            </p>
            <div class="note">
                This course already makes extensive use of functions! Any time you click one of those "Run" buttons
                in an example, a function in a linked Javascript file is being called.
            </div>


            <!-- -------------------------------- Heading level 4 -------------------------------- -->
            <h4>Returning values (the <tt>return</tt> statement)</h4>
            <p>
                When a function has finished it can <em>return</em> a value back to the caller. This makes functions a very 
                powerful tool to aid with computations, particularly when the same computations are needed in may places 
                in a program. Javascript (as well as other languages) provides the statement <tt>return</tt> which is an 
                instruction to end a function and to return a value back to the caller. Here's a function which computes
                the double value of a given parameter and returns it to the caller.
            </p>
            <div class="example" demo-id="notImpl">
                <pre class="prettyprint linenums">
                    /**
                     * Returns the double value of the given parameter.
                     * 
                     * @param   x       The value to be doubled.
                     * @return          The double value.
                     */
                    function GetDoubleOf (x)
                    {
                        var dbl;

                        dbl = 2 * x;

                        return dbl;
                    }

                    /* -------------------------------------------------------------- */
                    var dblVal;

                    dblVal = GetDoubleOf (2);
                    console.log (dblVal);
                </pre>
            </div>
            <p>
                Note the <tt>return</tt> statement in line 13. In general, the <tt>return</tt> statement has 
                two purposes:
            </p>
            <ul>
                <li>
                    <p>
                        <b>It ends the enclosing function</b> which makes it a flow control statement. In our 
                        example function, this is not very relevant, because that function ends anyway after 
                        the <tt>return</tt> statement. However, a return statement can be placed anywhere inside 
                        a function which will end that function immediately, even if the function has more 
                        statement after the <tt>return</tt> instruction. We'll talk more about this below.
                    </p>
                </li>
                <li>
                    <p>
                        <b>It specifies the value to be returned</b>. Whilst this gives the <tt>return</tt> 
                        statement a dual purpose, it's a very convenient and logical place to pass a value back 
                        to the caller! The little bit of increased complexity doesn't really hurt (At least, most 
                        programmers can cope very well with it). In our example, the returned value is <tt>dbl</tt>, 
                        which will be <tt>4</tt>. Therefore, when the function has finished, the value <tt>4</tt> 
                        is being returned and assigned to the variable <tt>dblVal</tt> (line 19).
                    </p>
                </li>
            </ul>
            <div class="note">
                A function can never return more than <i>one</i> value. For example, the square root of 25 has got 
                two solutions, +5 and -5. However, <tt>Math.sqrt (25)</tt> returns <tt>+5</tt> only.
            </div>


            <!-- -------------------------------- Heading level 2 -------------------------------- -->
            <h2>Using functions in expressions</h2>
            <p>
                Since functions can return values, they can be used as part of expressions. In fact, in our example 
                above we already used the function <tt>GetDoubleOf</tt> inside the expression 
                <tt>dblVal = GetDoubleOf (2)</tt> (in line 19). When executing this assignment the Javascript engine 
                calls the function at the appropriate time. The term could have been more complex. 
                For example, we could have called <tt>GetDoubleOf</tt> as part of a longer calculation
            </p>
            <div class="example">
                <pre class="prettyprint">
                    dblVal = 5 * GetDoubleOf (12); /* 5 * 24 =&gt; 120 */
                </pre>
            </div>
            <p>
                We could even have used GetDoubleOf twice in the term
            </p>
            <div class="example">
                <pre class="prettyprint">
                    dblVal = 5 * GetDoubleOf (12) + GetDoubleOf (3) /* 5 * 24 + 6 =&gt; 126 */
                </pre>
            </div>
            <p>
                which would have called this function twice - using the returned values as part of the calculation. 
            </p>
            <div class="note">
                When using function calls in expressions, all rules of computing arithmetics apply. For example, 
                multiplication will still come before addition. See the chapter on 
                operatorso.
            </div>


            <!-- -------------------------------- Heading level 3 -------------------------------- -->
            <h3>Javascript inbuilt functions</h3>
            <p>
                Javascript offers many inbuilt functions, ready for your use. For example, there's a wealth 
                of Javascript functions to do mathematical operations. We won't handle the inbuilt functions 
                here, look them up in the 
                <a target="_blank" href="/docs/mdn/developer.mozilla.org/en-US/docs/Web/JavaScript/Reference.1.html">MDN</a>.
            </p>

            <!-- -------------------------------- Heading level 2 -------------------------------- -->
            <h2>Nefarious techniques with functions: Recursion</h2>
            <p>
                We learned that a function can be called from within another function. A function can even call 
                itself. This technique is called <em>recursion</em>. Recursion can be used to solve a complex 
                problem by subdividing it into simplified versions of itself. This sounds great, but what's it 
                useful for?
            </p>

            <!-- -------------------------------- Heading level 3 -------------------------------- -->
            <h3>Trees, trees and more trees...</h3>
            <p>
                One often used data structure is a <em>tree</em>. A tree consists of a number of nodes, 
                each holding a piece of data. One example of such a tree is a file structure with sub directories 
                and files - such as this one:
            </p>
            <figure>
                <img src="course/it001/lessons/08/img/10.png"/>
                <figcaption>File structure</figcaption>
            </figure>
            <p>
                In this directory structure, each node is either a (sub) directory or a file. Here's a more
                tree like representation of our file structure:
            </p>
            <figure>
            <img src="course/it001/lessons/08/img/11.png"/>
                <figcaption>File structure tree</figcaption>
            </figure>
            <p>
                The whole arrangement looks like an tree (that's why it's called a tree) - except, it's 
                depicted upside down! The nodes are linked to each other in such a way that each node has 
                got a parent and zero or more child nodes. Nodes with no children are called <em>leaves</em>. 
                There's one node which doesn't have a parent, that one is called the <em>root</em> of the tree. 
                If you look closely you can see that all leaf nodes are files, all other nodes are 
                (sub) directories, and the root node is the directory <tt>/doc</tt>.
            </p>


            <!-- -------------------------------- Heading level 4 -------------------------------- -->
            <h4>Walking with the monkey</h4>
            <p>
                Suppose, our directory tree has got a hungry monkey living in it, and the monkey wants to visit all of 
                the nodes in our tree to find the banana and destroy it! Thanks to recursion, the banana is as good as dead
                already!
            </p>

            <div class="example" demo-id="notImpl">
                <pre class="prettyprint">
                    function Visit (node)
                    {
                        var     i;
                        var     n;
                        var     nd;
                        var     isBanana;

                        isBanana = IsBanana (node);
                        if (isBanana)
                        {
                            console.log ("Yum Yum!");
                        }

                        n = GetNumChildren (node);
                        if (n >= 1)
                        {
                            for (i = 0; i &lt; n; i++)
                            {
                                nd = GetChildNode (node, i);
                                Visit (nd); /* Recursion: Visit child node */
                            }
                        }
                    }
                </pre>
            </div>
            <p>
                Apart from giving the monkey it's well deserved feeling of happiness the function doesn't do 
                very much yet. However, it would be possible to add code in the function which does nifty things
                with every node such as changing the node's data or searching for some content.
            </p>
        </article>
    </body>
</html>
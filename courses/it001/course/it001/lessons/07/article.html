<html>
    <head>
    </head>
    <body>
        <article chapter-id="07">

            <!-- -------------------------------- Heading level 1 -------------------------------- -->
            <h1>Control flow</h1>
            <p>
                Control flow is the order in which the statements are executed when the program runs. Generally, 
                statements are executed from top to bottom, in the order in which they appear in the program. 
                This linear control flow is not always useful. Here's an example of a program with a less than
                useful linear control flow:
            </p>
            <div class="example" demo-id="it001_Ex_07_010">
                <pre class="prettyprint">
                    /*
                    * For each second in 0, 1, 2, ..., 10 we compute
                    * the distance a vehicle will have travelled at
                    * a constant speed of 30 m/s.
                    */

                    var v = 30;
                    var t;
                    var x;
                    var msg;

                    t = 0;
                    x = v * t;
                    msg = "After " + t + " seconds, the vehicle will have travelled " + x + " meters.";
                    console.log (msg);

                    t = 1;
                    x = v * t;
                    msg = "After " + t + " seconds, the vehicle will have travelled " + x + " meters.";
                    console.log (msg);

                    t = 2;
                    x = v * t;
                    msg = "After " + t + " seconds, the vehicle will have travelled " + x + " meters.";
                    console.log (msg);

                    t = 3;
                    x = v * t;
                    msg = "After " + t + " seconds, the vehicle will have travelled " + x + " meters.";
                    console.log (msg);

                    t = 4;
                    x = v * t;
                    msg = "After " + t + " seconds, the vehicle will have travelled " + x + " meters.";
                    console.log (msg);

                    t = 5;
                    x = v * t;
                    msg = "After " + t + " seconds, the vehicle will have travelled " + x + " meters.";
                    console.log (msg);

                    t = 6;
                    x = v * t;
                    msg = "After " + t + " seconds, the vehicle will have travelled " + x + " meters.";
                    console.log (msg);

                    t = 7;
                    x = v * t;
                    msg = "After " + t + " seconds, the vehicle will have travelled " + x + " meters.";
                    console.log (msg);

                    t = 8;
                    x = v * t;
                    msg = "After " + t + " seconds, the vehicle will have travelled " + x + " meters.";
                    console.log (msg);

                    t = 9;
                    x = v * t;
                    msg = "After " + t + " seconds, the vehicle will have travelled " + x + " meters.";
                    console.log (msg);

                    t = 10;
                    x = v * t;
                    msg = "After " + t + " seconds, the vehicle will have travelled " + x + " meters.";
                    console.log (msg);
                </pre>
            </div>
            <p>
                This program is far too long! The main reason for the inflated size is unecessary 
                repetition of code. The following program achieves the same goal with a 
                <tt>for</tt> loop (lines 12 to 17):
            </p>
            <div class="example" demo-id="it001_Ex_07_020">
                <pre class="prettyprint linenums">
                    /*
                     * For each second in 0, 1, 2, ..., 10 we compute 
                     * the distance a vehicle will have travelled at 
                     * a constant speed of 30 m/s.
                     */

                    var v = 30;
                    var t;
                    var x;
                    var msg;

                    for (t = 0; t &lt;= 10; t++)
                    {
                        x   = v * t;
                        msg = "After " + t + " seconds, the vehicle will have travelled " + x + " meters.";
                        console.log (msg);
                    }
                </pre>
            </div>
            <p>
                As we have seen, it's not always helpful to restrict a program to linear control flow. 
                Often it's necessary to break the flow of execution up, by using decision making 
                or looping. The <tt>for</tt> loop is one example of a special group of statements that 
                change the control flow of a program. Such statements are called <em>control flow 
                statements</em>.
            </p>


            <!-- -------------------------------- Heading level 2 -------------------------------- -->
            <h2>Conditions</h2>
            <p>
                Control flow statements operate on <em>logical conditions</em>. A logical condition
                is a term which evaluates to a boolean value, i.e. either <tt>true</tt> or <tt>false</tt>.
                The logical condition must always be enclosed by brackets <tt>()</tt>.
                Here are a few examples of logical conditions:
            </p>
            <div class="example" demo-id="it001_Ex_07_030">
                <pre class="prettyprint">
                    x = 5;
                
                    a = (x &gt;= 10);                 // true if a is at least 10
                    b = (x &gt;= 5)  &amp;&amp;  (x &lt;= 10);   // true if a is between 5 and 10
                    c = (x % 2  ==  0);            // true if a is even
                </pre>
            </div>
            <div class="related-info">
                For more on logical terms, see the chapter on operators.
            </div>


            <!-- -------------------------------- Heading level 2 -------------------------------- -->
            <h2>Statement blocks</h2>
            <p>
                A control flow statement executes single statements or whole blocks. Statement blocks need 
                to be enclosed in braces <tt>{}</tt>.
            </p>
            <div class="example">
                <pre class="prettyprint">
                    if (a == 0)
                    { /* <--- Opening brace */
                        b = "here is ";
                        c = "a block ";
                        d = "of statements.";
                        console.log ("a is 0, so " + b + c + d);
                    } /* <--- Closing brace */
                </pre>
            </div>
            <p>
                No braces are needed if there's just one statement to be executed.
            </p>
            <div class="example">
                <pre class="prettyprint">
                    a = 1;
                    b = 0;
                    if (a == 0)
                        b = 5;
                </pre>
            </div>
            <p>
                However, the variant without braces can be unsafe. For example when adding more 
                statements later, it's easy to forget the braces.
            </p>
            <div class="example" demo-id="it001_Ex_07_040">
                <pre class="prettyprint">
                    a = 1;
                    b = 0;
                    if (a == 0)
                        b = 5;
                        console.log ("b has changed to " + b); // This will ALWAYS execute (why?)
                </pre>
            </div>
            <p>
                Since nothing is lost by using braces, it's recommendable 
                to always use braces - even if a block contains just one statement.
            </p>
            <div class="example" demo-id="it001_Ex_07_050">
                <pre class="prettyprint">
                    a = 0;
                    b = 0;
                    if (a == 0)
                    {
                        b = 5;
                    }
                </pre>
            </div>
            <div class="note">
                In this course we will <i>always</i> use statement blocks (i.e. code in braces) 
                for control flow statements.
            </div>


            <!-- -------------------------------- Heading level 2 -------------------------------- -->
            <h2>Semicolon</h2>
            <p>
                Take <i>great care</i> with semicolons in control statements! 
                With control statements, a semicolon in the wrong place can 
                have unwanted side effects! The reason why the following program 
                shows the message box is that the semicolon after the 
                <tt>if</tt> clause is seen as an empty statement (meaning: "do nothing").
            </p>
            <div class="example" demo-id="it001_Ex_07_060">
                <pre class="prettyprint">
                    a = 5;
                    if (a == 0); /* <--- ouch */
                    {
                        window.alert ("Yayy, a is zero!");
                    }
                </pre>
            </div>
            <div class="note">For most control statements, avoid semicolons after the control clause!</div>


            <!-- -------------------------------- Heading level 2 -------------------------------- -->
            <h2>Decisions</h2>
            <p>
                Decisions change the flow of execution depending on some condition.
            </p>


            <!-- -------------------------------- Heading level 3 -------------------------------- -->
            <h3><tt>if ... else ...</tt></h3>
            <p>
                The <tt>if</tt> statement executes a block of statements if a condition evaluates to <tt>true</tt>. 
            </p>
            <div class="example" demo-id="it001_Ex_07_070">
                <pre class="prettyprint">
                    if (a == 0)
                    {
                        b = "here is ";
                        c = "a block ";
                        d = "of statements.";
                        console.log ("a is 0, so " + b + c + d);
                    }
                </pre>
            </div>
            <p>
                Optionally, an else clause can be added to execute another block of statements when the condition 
                evaluates to <tt>false</tt>.
            </p>
            <div class="example" demo-id="it001_Ex_07_080">
                <pre class="prettyprint">
                    if (a == 0)
                    {
                        b = "here is ";
                        c = "a block ";
                        d = "of statements.";
                        console.log ("a is 0, so " + b + c + d);
                    }
                    else
                    {
                        b = "here is ";
                        c = "another block ";
                        d = "of statements.";
                        console.log ("a is NOT 0, so " + b + c + d);
                    }
                </pre>
            </div>
            <p>
                It's possible to chain several <tt>else if</tt> statements. This will execute the satement block 
                where the condition matches.
            </p>
            <div class="example" demo-id="it001_Ex_07_090">
                <pre class="prettyprint">
                    a = 1;
                    if (a == -1)
                    {
                        // this will not execute
                    }
                    else if (a == 0)
                    {
                        // this won't execute either
                    }
                    else if (a >= 1)
                    {
                        // bingo!
                    }
                    else
                    {
                        // the fallback case whan nothing matches
                    }
                </pre>                    
            </div>


            <!-- -------------------------------- Heading level 3 -------------------------------- -->
            <h3><tt>switch</tt></h3>
            <p>
                The <tt>switch</tt> statement executes a different statement block
                depending on the result of one term. Here's an example of
                a switch statement as it would be used in most situations:
            </p>
            <div class="example" demo-id="it001_Ex_07_100">
                <pre class="prettyprint linenums">
                    a = 1;
                    switch (a)
                    {
                        case 0:
                            console.log ("Zero");
                            break;
                        case 1:
                            console.log ("One");
                            break;
                        case 5:
                            console.log ("Five");
                            break;
                    }
                </pre>
            </div>
            <p>
                In this example,
            </p>
            <ul>
                <li>
                    the <tt>switch</tt> statement matches the value of the variable 
                    <tt>a</tt> against the values in three test cases: <tt>0</tt>, 
                    <tt>1</tt>, and, <tt>5</tt> (lines 4, 7, 10).
                </li>
                <li>
                    <tt>a</tt> happens to be <tt>1</tt>, therefore <tt>case 1</tt> 
                    matches (line 7).
                </li>
                <li>
                    This will execute the code piece inside <tt>case 1</tt>. (lines 8 to 9).
                </li>
            </ul>
            <p>
                The example code is equivalent to the following <tt>if</tt> ... <tt>else if</tt> 
                construct:
            </p>
            <div class="example" demo-id="it001_Ex_07_110">
                <pre class="prettyprint">
                    a = 1;
                    if (a === 0)
                    {
                        console.log ("Zero");
                    }
                    else if (a === 1)
                    {
                        console.log ("One");
                    }
                    else if (a === 5)
                    {
                        console.log ("Five");
                    }    
                </pre>
            </div>


            <!-- -------------------------------- Heading level 4 -------------------------------- -->
            <h4>fall-through</h4>
            <p>
                In most situations, the code in each <tt>case</tt> clause ends with the 
                <tt>break</tt> statement. Without the <tt>break</tt> statement, we would get 
                <em>fall through</em>. In the following example, <tt>a</tt> matches 
                <tt>case 1</tt>, but the execution "falls through" into <tt>case 2</tt>.
                This means, <tt>case 1</tt> and <tt>case 2</tt> are both handled.
            </p>
            <div class="example" demo-id="it001_Ex_07_120">
                <pre class="prettyprint">
                    a = 1;
                    switch (a)
                    {
                        case 0:
                            console.log ("zero");
                            break;
                        case 1:
                        case 2:
                            console.log ("one or two");
                    }
                </pre>
            </div>
            <p>
                This code is equivalent to:
            </p>
            <div class="example" demo-id="it001_Ex_07_130">
                <pre class="prettyprint">
                a = 1;
                if (a === 0)
                {
                    console.log ("zero");
                }
                else if ((a === 1)  ||  (a === 2))
                {
                    console.log ("one or two");
                }
                </pre>
            </div>
            <p>
                Fall-through would fully handle all cases after a matching case. 
                In the following example, <tt>case 1</tt>, <tt>case 2</tt>, and, 
                <tt>case 3</tt> would be fully handled, i.e. the console would 
                show "one", "two, and, "three".
            </p>
            <div class="example" demo-id="it001_Ex_07_140">
                <pre class="prettyprint">
                    a = 1;
                    switch (a)
                    {
                        case 0:
                            console.log ("zero");
                        case 1:
                            console.log ("one");
                        case 2:
                            console.log ("two");
                        case 3:
                            console.log ("three");
                    }
                </pre>
            </div>
            <p>
                Fall-through can be a powerful tool, but it can make it hard to fully 
                understand what such a <tt>switch</tt> statement does. Try to guess 
                what the console log will show:
            </p>
            <div class="example">
                <pre class="prettyprint">
                    a = 1;
                    switch (a)
                    {
                        case 0:
                            a++;
                        case 1:
                            a--;
                        case 2:
                            a++;
                        case 3:
                            a--;
                    }

                    switch (a)
                    {
                        case 0:
                            a--;
                        case 1:
                            a++;
                        case 2:
                            a--;
                        case 3:
                            a++;
                    }
                    console.log (a); // Make your guess...
                </pre>
            </div>
            <div class="note">Use fall-through with <b>great</b> caution! If in doubt, use <tt>if</tt> statements - they make the source code easier to read.</div>


            <!-- -------------------------------- Heading level 4 -------------------------------- -->
            <h4>When nothing matches...</h4>
            <p>
                There are situations when you want to handle the nothing-matches situation. There's
                a special case for this purpose, the <em>default</em> case. The default case will 
                execute when all other cases fail. In the following example, the value of <tt>a</tt> 
                does not match any of the given cases. The only case which matches is the 
                <tt>default</tt> case. Therefore the program
                will log the message "unknown number".
            </p>
            <div class="example" demo-id="it001_Ex_07_150">
                <pre class="prettyprint">
                    a = 10;
                    switch (a)
                    {
                        case 0:
                            console.log ("zero");
                            break;
                        case 1:
                            console.log ("one");
                            break;
                        case 2:
                            console.log ("two");
                            break;
                        case 3:
                            console.log ("three");
                            break;
                        default:
                            console.log ("unknown number");
                    }
                </pre>
            </div>
            <p>
                There's no need to put a <tt>break</tt> statement at the end of the <tt>default</tt>
                case.
            </p>
            <div class="example">
                <pre class="prettyprint">
                    a = 10;
                    switch (a)
                    {
                        case 0:
                            ...
                        case 1:
                            ...
                        default:
                            console.log ("unknown number");
                            break;          // Unecessary (Why?)
                    }
                </pre>
            </div>
            <div class="note">
                It's always a good idea to include a <tt>default</tt> case in your <tt>switch</tt> 
                statements, even if that case is empty. This can make later modifications easier.
            </div>


            <!-- -------------------------------- Heading level 4 -------------------------------- -->
            <h4>Syntax specialities</h4>
            <p>
                The <tt>switch</tt> statement has a unique syntax in that all <tt>case</tt>
                clauses and the <tt>default</tt> clause must end with a colon '<tt>:</tt>'.
            </p>
            <div class="example">
                <pre class="prettyprint">
                    switch (x)
                    {
                        case 1:
                            // do something
                            break;
                        case 2:
                            // do something
                            break;
                        default:
                            // do something
                    }
                </pre>                        
            </div>                


            <!-- -------------------------------- Heading level 2 -------------------------------- -->
            <h2>Loops</h2>
            <p>
                Loops repeat a section of code whilst a condition holds <tt>true</tt>. Each repetition 
                is called an <em>iteration</em> of the code to be repeated.
            </p>


            <!-- -------------------------------- Heading level 3 -------------------------------- -->
            <h3><tt>for</tt> loop</h3>
            <p>
                A <tt>for</tt> loop executes a piece of code a number of times. It's 
                most useful when running the code with a different value with each iteration.
                In it's general form, the <tt>for</tt> loop contains two expressions, a 
                logical term and a block of statements.
            </p>
            <div class="example">
                <pre class="prettyprint">
                    for (initial-expression; continue-condition; iteration-expression)
                    {
                        /* block of statements */
                    }
                </pre>
            </div>
            <dl>
                <dt>initial-expression</dt>
                <dd>
                    An expression to set an initial state (e.g. initializing a counter variable).
                </dd>
                <dt>continue-condition</dt>
                <dd>
                    A logical term to be evaluated <i>before</i> each loop iteration. If the
                    term evaluates to <tt>true</tt> then the block of statements is being 
                    executed. Otherwise the loop exits, and control continues with the code after the 
                    <tt>for</tt> statement.
                </dd>
                <dt>iteration-expression</dt>
                <dd>
                    An expression to be evaluated <i>after</i> each loop iteration (e.g. incrementing 
                    a counter variable).
                </dd>
                <dt>Block of statements</dt>
                <dd>
                    The statements to be executed during each loop iteration.
                </dd>
            </dl>


            <!-- -------------------------------- Heading level 4 -------------------------------- -->
            <h4>How it works</h4>
            <p>
                The scenario below demonstrates how the <tt>for</tt> statement works.
            </p>
            <div class="example" demo-id="it001_Ex_07_160">
                <pre class="prettyprint">
                    /* Prints the squares of all values in [1, 3] to the console. */
                    for (x = 1; x &lt;= 3; x++)
                    {
                        y = x * x;
                        console.log ("x = " + x + ", y = " + y);
                    }    
                </pre>
            </div>


            <!-- -------------------------------- Heading level 4 -------------------------------- -->
            <h4>Example application</h4>
            <p>
                One situation where <tt>for</tt> loops are often used is when doing bulk operations
                on all elements within an array. Here's an example where we calculate the average
                value of a series of numbers:
            </p>
            <div class="example" demo-id="it001_Ex_07_170">
                <pre class="prettyprint">
                    var x = [15, 20, 13, 25, 7, 9, 18];
                    var i;
                    var n;
                    var sum;
                    var avg;

                    n   = x.length;
                    sum = 0;
                    for (i = 0; i &lt; n; i++)
                    {
                        sum += x [i];
                    }
                    avg = sum / n;

                    console.log ("Average value: " + avg);
                </pre>
            </div>


            <!-- -------------------------------- Heading level 3 -------------------------------- -->
            <h3><tt>while</tt></h3>
            <p>
                A <tt>while</tt> loop repeats a section of code as long as a condition holds 
                <tt>true</tt>. In it's general form, the <tt>while</tt> loop contains a 
                logical term and a block of statements.
            </p>
            <div class="example">
                <pre class="prettyprint">
                    while (continue-condition)
                    {
                        /* block of statements */
                    }
                </pre>
            </div>
            <dl>
                <dt>continue-condition</dt>
                <dd>
                    A logical term to be evaluated <i>before</i> each loop iteration.
                    If the term evaluates to <tt>true</tt> then the block of statements
                    will be executed. Otherwise, the loop exits and control continues with the 
                    code after the <tt>while</tt> statement.
                </dd>
                <dt>Block of statements</dt>
                <dd>
                    The statements to be executed during each loop iteration.
                </dd>
            </dl>


            <!-- -------------------------------- Heading level 4 -------------------------------- -->
            <h4>How it works</h4>
            <p>
                The following scenario shows the inner workings of the 
                <tt>while</tt> loop. The program solves the same problem 
                as the one in the <tt>for</tt> loop scenario, this 
                time with a <tt>while</tt> loop.
            </p>
            <div class="example" demo-id="it001_Ex_07_180">
                <pre class="prettyprint">
                    /* Prints the squares of all values in [1, 3] to the console. */
                    var x = 1;
                    while (x &lt;= 3)
                    {
                        y = x * x;
                        console.log ("x = " + x + ", y = " + y);

                        x++;
                    }
                </pre>
            </div>


            <!-- -------------------------------- Heading level 4 -------------------------------- -->
            <h4>Example application</h4>
            <p>
                This program converts a number into its binary representation.
                <div class="example" demo-id="it001_Ex_07_190">
                    <pre class="prettyprint">
                        var num = 6;
                        var out;

                        out = "";
                        while (num >= 1)
                        {
                            bit  = num & 1;
                            num = num >>> 1;
                            out  = "" + bit + out;
                        }
                        console.log (out);
                    </pre>
                </div>
            </p>


            <!-- -------------------------------- Heading level 3 -------------------------------- -->
            <h3><tt>do...while</tt></h3>
            <p>
                A <tt>do...while</tt> loop repeats a section of code until a condition holds <tt>true</tt>. In it's 
                general form, the <tt>do...while</tt> loop contains a block of statements enclosed by 
                <tt>do</tt> and <tt>while</tt>.
            </p>
            <div class="example">
                <pre class="prettyprint">
                    do
                    {
                        /* block of statements */
                    }
                    while (continue-condition);
                </pre>
            </div>
            <dl>
                <dt>continue-condition</dt>
                <dd>
                    A logical term to be evaluated <i>after</i> each loop iteration.
                    If the term evaluates to <tt>true</tt> then the execution flow 
                    jumps back to executing the the statement block again. Otherwise, 
                    the loop exits and control continues with the code after the 
                    <tt>do...while</tt> statement.
                </dd>
                <dt>Block of statements</dt>
                <dd>
                    The statements to be executed during each loop iteration.
                </dd>
            </dl>
            <div class="note">
                When using the <tt>do...while</tt> loop, remember to put a semicolon after 
                the <tt>while</tt> clause.
            </div>


            <!-- -------------------------------- Heading level 4 -------------------------------- -->
            <h4>How it works</h4>
            <p>
                A <tt>do...while</tt> works in a very similar way to a <tt>while</tt> loop. 
                The only difference to the <tt>while</tt> loop is...
            </p>
            <ul>
                <li>
                    ... that the continue-condition comes <i>after</i> the block of statements,
                </li>
                <li>
                    ... hence is evaluated <i>after</i> each loop iteration, and not before 
                        as in the case of the <tt>while</tt> loop.</li>
            </ul>
            <p>
                The following scenario shows the inner workings of the <tt>do...while</tt> loop
                step by step. The program solves the same problem as the one in the <tt>while</tt> 
                loop scenario, this time with a <tt>do...while</tt> loop.
            </p>
            <div class="example" demo-id="it001_Ex_07_200">
                <pre class="prettyprint">
                    /* Prints the squares of all values in [1, 3] to the console. */
                    var x = 1;
                    do
                    {
                        y = x * x;
                        console.log ("x = " + x + ", y = " + y);

                        x++;
                    }
                    while (x &lt;= 3);
                </pre>
            </div>


            <!-- -------------------------------- Heading level 4 -------------------------------- -->
            <h4>Example application</h4>
            <p>
                This program creates a stream of random numbers between 
                0 and 32767 and counts the iterations until a number smaller
                than 1000 is created. The count is printed to console.
            </p>
            <div class="example" demo-id="it001_Ex_07_210">
                <pre class="prettyprint">
                    var seed = 5323;
                    var rnd;
                    var count;

                    count = 0;
                    do
                    {
                        seed = 8253729 * seed + 2396403;
                        rnd  = seed % 32767;
                        count++;
                    }
                    while (rnd &gt;= 1000);
                    console.log ("Number of iterations until rnd &lt;= 1000: " + count);
                </pre>
            </div>
            <div class="note">
                This random number generator isn't usable for secure random numbers.
            </div>


            <!-- -------------------------------- Heading level 3 -------------------------------- -->
            <h3><tt>break</tt></h3>
            <p>
                The <tt>break</tt> statement breaks out of a loop or <tt>switch</tt>. Control is 
                transferred to the code after the loop or <tt>switch</tt>.
            </p>
            <div class="example" demo-id="it001_Ex_07_220">
                <pre class="prettyprint">
                    var a = 10;
                    while (a &gt;= 1)
                    {
                        a--;
                        if (a &lt;= 8)
                        {
                            break;
                        }
                    }
                </pre>
            </div>
        </article>
    </body>
</html>